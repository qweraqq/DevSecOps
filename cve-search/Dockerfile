FROM mongo:3.4

EXPOSE 5000
EXPOSE 27017

RUN apt-get update && \
    apt-get install -yqq \
      python3 \
      python3-pip \
      python3-dev \
      pkg-config \
      software-properties-common \
      git \
      vim \
      libxml2-dev \
      libxslt1-dev \
      zlib1g-dev \
      libffi6 \
      build-essential \
      libssl-dev \
      libffi-dev \
      redis-server
      
RUN mkdir -p /data/db
RUN mkdir /home/cve
WORKDIR /home/cve
    
RUN git clone https://github.com/cve-search/cve-search.git
WORKDIR /home/cve/cve-search
RUN pip3 install -r requirements.txt

COPY ./scripts/db-init.sh .
RUN chmod a+x db-init.sh
RUN ./db-init.sh

COPY ./scripts/docker-entrypoint.sh /usr/local/bin/docker-entrypoint
RUN chmod a+x /usr/local/bin/docker-entrypoint